From 33970ed7b793a59e6a9926b8b5c696ecf9f126a7 Mon Sep 17 00:00:00 2001
From: Valentin Raevsky <valentin@compulab.co.il>
Date: Wed, 29 Apr 2020 21:05:34 +0300
Subject: [PATCH 40/42] compulab-imx8mq: dtsi: Make use of USDHC1_RESET_B

Signed-off-by: Valentin Raevsky <valentin@compulab.co.il>
---
 arch/arm64/boot/dts/compulab/compulab-imx8mq.dtsi | 26 ++++++-----------------
 1 file changed, 6 insertions(+), 20 deletions(-)

diff --git a/arch/arm64/boot/dts/compulab/compulab-imx8mq.dtsi b/arch/arm64/boot/dts/compulab/compulab-imx8mq.dtsi
index d8bdd35..326df96 100644
--- a/arch/arm64/boot/dts/compulab/compulab-imx8mq.dtsi
+++ b/arch/arm64/boot/dts/compulab/compulab-imx8mq.dtsi
@@ -44,16 +44,6 @@
 			enable-active-high;
 		};
 
-		reg_usdhc1_vmmc: usdhc1_vmmc {
-			compatible = "regulator-fixed";
-			regulator-name = "USBHC1_VSD_1V8";
-			regulator-min-microvolt = <1800000>;
-			regulator-max-microvolt = <1800000>;
-			gpio = <&gpio2 10 GPIO_ACTIVE_HIGH>;
-			off-on-delay = <20000>;
-			enable-active-high;
-		};
-
 		reg_usdhc2_vmmc: usdhc2_vmmc {
 			compatible = "regulator-fixed";
 			regulator-name = "USDHC2_VSD_3V3";
@@ -251,12 +241,6 @@
 			>;
 		};
 
-		pinctrl_usdhc1_gpio: usdhc1grpgpio {
-			fsl,pins = <
-				MX8MQ_IOMUXC_SD1_RESET_B_GPIO2_IO10	0x1c
-			>;
-		};
-
 		pinctrl_usdhc1: usdhc1grp {
 			fsl,pins = <
 				MX8MQ_IOMUXC_SD1_CLK_USDHC1_CLK			0x83
@@ -270,6 +254,7 @@
 				MX8MQ_IOMUXC_SD1_DATA6_USDHC1_DATA6		0xc3
 				MX8MQ_IOMUXC_SD1_DATA7_USDHC1_DATA7		0xc3
 				MX8MQ_IOMUXC_SD1_STROBE_USDHC1_STROBE 		0x83
+				MX8MQ_IOMUXC_SD1_RESET_B_USDHC1_RESET_B		0xc1
 			>;
 		};
 
@@ -286,6 +271,7 @@
 				MX8MQ_IOMUXC_SD1_DATA6_USDHC1_DATA6		0xcd
 				MX8MQ_IOMUXC_SD1_DATA7_USDHC1_DATA7		0xcd
 				MX8MQ_IOMUXC_SD1_STROBE_USDHC1_STROBE		0x8d
+				MX8MQ_IOMUXC_SD1_RESET_B_USDHC1_RESET_B		0xc1
 			>;
 		};
 
@@ -302,6 +288,7 @@
 				MX8MQ_IOMUXC_SD1_DATA6_USDHC1_DATA6		0xdf
 				MX8MQ_IOMUXC_SD1_DATA7_USDHC1_DATA7		0xdf
 				MX8MQ_IOMUXC_SD1_STROBE_USDHC1_STROBE		0x9f
+				MX8MQ_IOMUXC_SD1_RESET_B_USDHC1_RESET_B		0xc1
 			>;
 		};
 
@@ -552,12 +539,11 @@
 
 &usdhc1 {
 	pinctrl-names = "default", "state_100mhz", "state_200mhz";
-	pinctrl-0 = <&pinctrl_usdhc1>, <&pinctrl_usdhc1_gpio>;
-	pinctrl-1 = <&pinctrl_usdhc1_100mhz>, <&pinctrl_usdhc1_gpio>;
-	pinctrl-2 = <&pinctrl_usdhc1_200mhz>, <&pinctrl_usdhc1_gpio>;
+	pinctrl-0 = <&pinctrl_usdhc1>;
+	pinctrl-1 = <&pinctrl_usdhc1_100mhz>;
+	pinctrl-2 = <&pinctrl_usdhc1_200mhz>;
 	bus-width = <8>;
 	non-removable;
-	vmmc-supply = <&reg_usdhc1_vmmc>;
 	status = "okay";
 };
 
-- 
1.9.1

