From ee414e19a505eca09a92a8113e881893386bb9c7 Mon Sep 17 00:00:00 2001
From: Valentin Raevsky <valentin@compulab.co.il>
Date: Wed, 18 Sep 2019 16:47:06 +0300
Subject: [PATCH 31/34] cl-som-imx8: lvds: viavi: Add viavi panel support

Signed-off-by: Valentin Raevsky <valentin@compulab.co.il>
---
 arch/arm64/boot/dts/compulab/Makefile              |  2 +
 arch/arm64/boot/dts/compulab/panel-viavi.dtsi      | 52 ++++++++++++++++++++++
 .../boot/dts/compulab/sbc-imx8-lvds-viavi-dcss.dts | 19 ++++++++
 .../dts/compulab/sbc-imx8-lvds-viavi-lcdif.dts     | 36 +++++++++++++++
 4 files changed, 109 insertions(+)
 create mode 100644 arch/arm64/boot/dts/compulab/panel-viavi.dtsi
 create mode 100644 arch/arm64/boot/dts/compulab/sbc-imx8-lvds-viavi-dcss.dts
 create mode 100644 arch/arm64/boot/dts/compulab/sbc-imx8-lvds-viavi-lcdif.dts

diff --git a/arch/arm64/boot/dts/compulab/Makefile b/arch/arm64/boot/dts/compulab/Makefile
index e7e4166..8f728e6 100644
--- a/arch/arm64/boot/dts/compulab/Makefile
+++ b/arch/arm64/boot/dts/compulab/Makefile
@@ -9,6 +9,8 @@ dtb-$(CONFIG_ARCH_FSL_IMX8MQ) += sbc-imx8-no-edid.dtb
 dtb-$(CONFIG_ARCH_FSL_IMX8MQ) += sbc-imx8-m4.dtb
 dtb-$(CONFIG_ARCH_FSL_IMX8MQ) += sbc-imx8-lvds-chimei-dcss.dtb
 dtb-$(CONFIG_ARCH_FSL_IMX8MQ) += sbc-imx8-lvds-chimei-lcdif.dtb
+dtb-$(CONFIG_ARCH_FSL_IMX8MQ) += sbc-imx8-lvds-viavi-dcss.dtb
+dtb-$(CONFIG_ARCH_FSL_IMX8MQ) += sbc-imx8-lvds-viavi-lcdif.dtb
 
 always		:= $(dtb-y)
 subdir-y	:= $(dts-dirs)
diff --git a/arch/arm64/boot/dts/compulab/panel-viavi.dtsi b/arch/arm64/boot/dts/compulab/panel-viavi.dtsi
new file mode 100644
index 00000000..40e9c9a
--- /dev/null
+++ b/arch/arm64/boot/dts/compulab/panel-viavi.dtsi
@@ -0,0 +1,52 @@
+#if 0
+&mipi_dsi {
+/delete-property/no_clk_reset;
+};
+
+&mipi_dsi_bridge {
+/delete-property/no_clk_reset;
+};
+#endif
+
+&iomuxc {
+    compulab-imx8mq-lvds {
+        pinctrl_dsi_lvds: dsilvds_group {
+            fsl,pins = <
+                MX8MQ_IOMUXC_GPIO1_IO06_GPIO1_IO6 0x16
+            >;
+        };
+    };
+};
+
+&ti_bridge {
+        ti,dsi-lanes = <4>;
+        ti,lvds-format = <1>;
+        ti,lvds-bpp = <24>;
+        ti,width-mm = <255>;
+        ti,height-mm = <145>;
+
+        display-timings {
+            lvds {
+                /*clock-frequency = <74250000>;*/
+                clock-frequency = <60000000>;
+                hactive = <800>;
+                vactive = <480>;
+
+		/* Horizontal Active Blanking Period = 137 */
+                hsync-len    = <57>;
+                hback-porch  = <40>;
+                hfront-porch = <40>;
+
+		/* Vertical Active Blanking Period = 210 */
+                vsync-len    = <168>;
+                vback-porch  = <13>;
+                vfront-porch = <29>;
+
+                hsync-active = <0>;
+                vsync-active = <0>;
+
+                de-active = <1>;
+                pixelclk-active = <0>;
+            };
+        };
+};
diff --git a/arch/arm64/boot/dts/compulab/sbc-imx8-lvds-viavi-dcss.dts b/arch/arm64/boot/dts/compulab/sbc-imx8-lvds-viavi-dcss.dts
new file mode 100644
index 00000000..23d0d19
--- /dev/null
+++ b/arch/arm64/boot/dts/compulab/sbc-imx8-lvds-viavi-dcss.dts
@@ -0,0 +1,19 @@
+/*
+ * Copyright (C) 2018 CopuLab Ltd.
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ */
+
+#include "sbc-imx8.dts"
+#include "compulab-imx8mq-lvds-mipi.dtsi"
+#include "compulab-imx8mq-mipi-dcss.dtsi"
+#include "compulab-imx8mq-goodix.dtsi"
+#include "panel-viavi.dtsi"
diff --git a/arch/arm64/boot/dts/compulab/sbc-imx8-lvds-viavi-lcdif.dts b/arch/arm64/boot/dts/compulab/sbc-imx8-lvds-viavi-lcdif.dts
new file mode 100644
index 00000000..36bc16e
--- /dev/null
+++ b/arch/arm64/boot/dts/compulab/sbc-imx8-lvds-viavi-lcdif.dts
@@ -0,0 +1,36 @@
+/*
+ * Copyright (C) 2018 CopuLab Ltd.
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ */
+
+#include "sbc-imx8.dts"
+#include "compulab-imx8mq-lvds-mipi.dtsi"
+#include "compulab-imx8mq-mipi-lcdif.dtsi"
+#include "compulab-imx8mq-goodix.dtsi"
+#include "panel-viavi.dtsi"
+
+&ti_bridge {
+        display-timings {
+            lvds {
+                de-active = <0>;
+                pixelclk-active = <0>;
+            };
+        };
+};
+
+&dcss {
+	status = "disabled";
+};
+
+&hdmi {
+	status = "disabled";
+};
-- 
1.9.1

