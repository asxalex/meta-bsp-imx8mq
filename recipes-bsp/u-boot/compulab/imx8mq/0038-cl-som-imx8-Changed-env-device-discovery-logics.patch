From e1df7c059eb790c086bcb12c75a1ae9e36e9db08 Mon Sep 17 00:00:00 2001
From: Valentin Raevsky <valentin@compulab.co.il>
Date: Tue, 3 Mar 2020 18:01:26 +0200
Subject: [PATCH 38/38] cl-som-imx8: Changed env device discovery logics

Signed-off-by: Valentin Raevsky <valentin@compulab.co.il>
---
 board/compulab/cl-som-imx8/cl-som-imx8.c | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/board/compulab/cl-som-imx8/cl-som-imx8.c b/board/compulab/cl-som-imx8/cl-som-imx8.c
index 402e652..4b0c12c 100644
--- a/board/compulab/cl-som-imx8/cl-som-imx8.c
+++ b/board/compulab/cl-som-imx8/cl-som-imx8.c
@@ -20,6 +20,7 @@
 #include <asm/mach-imx/mxc_i2c.h>
 #include <asm/arch/clock.h>
 #include <asm/mach-imx/video.h>
+#include <asm/mach-imx/boot_mode.h>
 #include <asm/arch/video_common.h>
 #include <spl.h>
 #include <power/pmic.h>
@@ -349,7 +350,7 @@ int board_mmc_get_env_dev(int devno)
 
 uint mmc_get_env_part(struct mmc *mmc)
 {
-	if (mmc->part_support)
+	if (get_boot_device() == MMC1_BOOT)
 		return CONFIG_SYS_MMC_ENV_PART;
 
 	return 0;
-- 
1.9.1

